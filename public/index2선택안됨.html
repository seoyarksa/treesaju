 <!-- //         git add .
//               git commit -m "ë¡œê·¸ì¸íšŸìˆ˜ì œí•œ"   
//               git push origin main
//               git push
//               ê°•ì œì‹¤í–‰   vercel --prod --force
-->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />

<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet" />


<title>íŠ¸ë¦¬ ë§Œì„¸ë ¥</title>
  <!-- Supabase SDK -->
  <!-- (ë°”ê¾¼ í›„) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  
 <!-- 2) Supabase ì´ˆê¸°í™” (ì „ì—­ ë“±ë¡) -->
<script>
  if (!window.supabase) {
    alert("Supabase SDK ë¡œë“œ ì‹¤íŒ¨. ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” CDN ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
  }

  const userAgent = navigator.userAgent || navigator.vendor || window.opera;
  const isMobile = /android|iphone|ipad|ipod/i.test(userAgent);

  window.supabaseClient = window.supabase.createClient(
    "https://dxrgobsgeeshkybkbnxo.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR4cmdvYnNnZWVzaGt5YmtibnhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwOTAyNzIsImV4cCI6MjA3MzY2NjI3Mn0.vD1xSRezaTC2OUikZZJM7UntQaQWvOxRkvYiMl78UZA",
    {
      auth: {
        storage: isMobile ? window.localStorage : window.sessionStorage,
        autoRefreshToken: true,
        persistSession: true,
        detectSessionInUrl: true,
      },
    }
  );

  // í˜¸í™˜ìš©
  window.client = window.supabaseClient;
  console.log("[INDEX] supabaseClient ready:", !!window.supabaseClient);
</script>


<style>
  body {
    font-family: 'Nanum Gothic', sans-serif;
    margin: 0; padding: 0;
    background-color: #f8f8f8;
  }

  /* ë©êµ´ í…Œë‘ë¦¬ ì»¨í…Œì´ë„ˆ ì „ì²´ ê°ì‹¸ê¸° */
.vine-border-container {
  position: relative;
  display: inline-block;   /* âœ… ë‚´ìš© í¬ê¸°ë§Œí¼ë§Œ ë°•ìŠ¤ í¬ê¸° */
  padding: 40px;
  max-width: 100%;       /* âœ… í™”ë©´ ì „ì²´ í­ê¹Œì§€ ê°€ëŠ¥ */
  width: auto;           /* âœ… ë‚´ìš© í¬ê¸°ì— ë§ê²Œ ê¸°ë³¸ì€ auto */
  margin: 40px auto 80px auto;
  background-color: transparent;
  border: none;
  border-radius: 0;
  overflow: visible;     /* ë„ì¿¨ ì´ë¯¸ì§€ê°€ ì˜ì—­ ë°–ì— ìˆì„ ìˆ˜ ìˆê²Œ */
}

  /* íë¦¿í•œ ë°°ê²½ (ë‚´ìš© ì „ì²´ ë°°ê²½ ì—­í• ) */
  .text-bg {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(255, 255, 255, 0.7);
    border-radius: 10px;
    z-index: 1;
    pointer-events: none;
  }

/* ë©êµ´ ì´ë¯¸ì§€ 4ëª¨ì„œë¦¬ */
.vine-deco {
  position: absolute;
  width: 150px; 
  height: 150px;
  background-image: url('/images/vine.png');
  background-size: contain;
  background-repeat: no-repeat;
  opacity: 1;
  pointer-events: none;   /* ì…ë ¥ ê°€ë¦¬ì§€ ì•ŠìŒ */
  z-index: 9999;          /* âœ… ë©êµ´ì„ í•­ìƒ ë§¨ ìœ„ë¡œ */
}

.vine-top-left {
  top: 0; left: 0;
  transform: rotate(180deg);
}
.vine-top-right {
  top: 0; right: 0;
  transform: scaleX(-1) rotate(180deg);
}
.vine-bottom-left {
  bottom: 0; left: 0;
  transform: scaleY(-1) rotate(180deg);
}
.vine-bottom-right {
  bottom: 0; right: 0;
  transform: scaleX(-1) scaleY(-1) rotate(180deg);
}

/* ë‚´ë¶€ ì½˜í…ì¸  ì˜ì—­ - ë©êµ´ë³´ë‹¤ ë’¤ì— ìœ„ì¹˜ */
.vine-border-container > *:not(.text-bg):not(.vine-deco) {
  position: relative;
  z-index: 1;   /* âœ… ë©êµ´ë³´ë‹¤ ë‚®ê²Œ */
}

  /* ì œëª©, í¼ ìŠ¤íƒ€ì¼ */
  h1 {
    margin-top: 0;
    color: #222;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.25);
  }

  form#saju-form {
    margin-top: 20px;
  }

  /* ê²°ê³¼ ë° ì§ˆë¬¸ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
  #result,
  #sewoon,
  #today-saju-container,
  #question-box {
    background-color: rgba(255, 255, 255, 0.9);
    padding: 15px;
    margin-top: 20px;
    border-radius: 8px;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
    color: #222;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  }

  /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ (ê²°ê³¼ ë‚´ë¶€ í…Œì´ë¸”ìš©) */
  #result table,
  #sewoon table,
  #today-saju-container table {
    width: 100%;
    border-collapse: collapse;
  }
  #result table th,
  #result table td,
  #sewoon table th,
  #sewoon table td,
  #today-saju-container table th,
  #today-saju-container table td {
    padding: 8px 12px;
    border: 1px solid #ccc;
    background-color: transparent;
    color: #222;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  }
.btn-success {
  background-color: #28a745;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
}

.btn-success:hover {
  background-color: #218838;
}
.sewoon-cell.selected {
  background-color: #dff0d8; /* ì—°í•œ ì—°ë‘ìƒ‰ */
  border: 2px solid #28a745;
  box-shadow: 0 0 4px rgba(40,167,69,0.5);
}

  .green { color: green; font-weight: bold; }
  .red { color: red; font-weight: bold; }

    #sinsal-box table td {
      text-align: center;
      vertical-align: middle;
    }

#sinsal-box table {
  margin-left: auto;
  margin-right: auto;
}

#basic-section, #sinsal-section {
  display: none;
}



.tooltip {
  position: relative;
  cursor: pointer;
}

.tooltip::after {
  content: attr(data-desc);
  position: absolute;
  background: #333;
  color: #fff;
  padding: 6px 10px;
  border-radius: 4px;
  font-size: 13px;
  z-index: 9999;

  /* ì—¬ëŸ¬ ì¤„ ì¶œë ¥ ê°€ëŠ¥ */
  white-space: normal;
  word-break: keep-all;   /* ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ (ë„ì–´ì“°ê¸° ê¸°ì¤€) */
  max-width: 600px;       /* ì¤„ë°”ê¿ˆ ë°œìƒí•  ìµœëŒ€ í­ */
  line-height: 1.5;
  text-align: left;

  /* ìœ„ì¹˜: ìš”ì†Œ ìœ„ìª½ ì¤‘ì•™ */
  bottom: 120%;
  left: 50%;
  transform: translateX(-50%);

  display: block;         /* âœ… ì„¸ë¡œ í•œì¤„ ë¬¸ì œ ë°©ì§€ */
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}

.tooltip:hover::after {
  opacity: 1;
}

.nackhwa-table {
  border-collapse: collapse !important;   /* âœ… ìƒìœ„ í…Œì´ë¸” ì†ì„± ë¬´ì‹œ */
  width: 100%;
}

.nackhwa-table td,
.nackhwa-table th {
  border: 1px solid #999 !important;      /* âœ… ë‚´ë¶€ ì¹¸ ì„  ê°•ì œ í‘œì‹œ */
  padding: 2px;
}

      .parent #nackhwaPopup .nackhwa-table td,
.parent #nackhwaPopup .nackhwa-table th {
  border: 1px solid #999 !important;
}

#nackhwaPopup {
  width: auto !important;      /* âœ… ìë™ í¬ê¸° */
  min-width: unset !important; /* âœ… ê¸°ë³¸ ì œí•œ í•´ì œ */
  max-width: none !important;  /* âœ… ìµœëŒ€í­ ì œí•œ í•´ì œ */
  height: auto !important;     /* âœ… ë†’ì´ë„ ìë™ */
  white-space: nowrap;         /* âœ… ì¤„ë°”ê¿ˆ ë°©ì§€ */
}

.btn-success.active {
  background-color: #f18997; 
  color: #fff;
}

/* ê³ ê° ì´ë ¥ í‘œ ì „ì²´ */
#saju-history-table {
  width: 100%;
  border-collapse: collapse; /* ì´ì¤‘ì„  ì œê±° */
  font-size: 14px;
  margin-top: 10px;
}

/* ì…€ ê³µí†µ ìŠ¤íƒ€ì¼ */
#saju-history-table th,
#saju-history-table td {
  border: 1px solid #e0e0e0;
  padding: 8px 12px;
  text-align: center;
}

/* í—¤ë” ì¤„ */
#saju-history-table th {
  background-color: #f8f9fa;
  font-weight: bold;
}

/* ì¤„ë¬´ëŠ¬ íš¨ê³¼ */
#saju-history-table tr:nth-child(even) {
  background-color: #fcfcfc;
}

/* hover íš¨ê³¼ */
#saju-history-table tr:hover {
  background-color: #f1f7ff;
}

/* ì´ë¦„ í´ë¦­ ë§í¬ */
.saju-record-link {
  cursor: pointer;
  color: #007bff;
  text-decoration: underline;
}

/* ì‚­ì œ ë²„íŠ¼ */
.delete-record-btn {
  background: #ff4d4f;
  border: none;
  color: white;
  padding: 5px 10px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
}
.delete-record-btn:hover {
  background: #d9363e;
}




#page-info {
  margin-top: 12px;
  text-align: center;   /* âœ… ì „ì²´ ê°€ìš´ë° ì •ë ¬ */
}

.page-btn,
.page-num {
  margin: 0 2px;          /* âœ… ê°„ê²© ì¤„ì„ */
  padding: 2px 4px;       /* âœ… ì•ˆìª½ ì—¬ë°±ë„ ì¤„ì„ */
  border: none;
  background: none;
  cursor: pointer;
  font-size: 14px;
  color: #000;            /* ê¸°ë³¸ ê²€ì •ìƒ‰ */
}

.page-btn:hover,
.page-num:hover {
  text-decoration: underline;
}

.page-num.active {
  font-weight: bold;
  color: red;             /* âœ… í˜„ì¬ í˜ì´ì§€ë§Œ ë¹¨ê°• */
  text-decoration: none;
}


  /* ê³µì§€ 1ì¤„: ê¸¸ë©´ ë§ì¤„ì„ */
.notice-bar{
  display:flex; align-items:center;
  padding:8px 12px; border:1px solid #eee; background:#fff; font-size:14px;
}
.notice-bar .label{ flex:0 0 auto; }
.notice-bar .title{
  flex:1 1 auto; min-width:0;               /* â† í•µì‹¬: ê³µê°„ ìµœëŒ€ í™œìš© */
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
#latest-notice,
#latest-notice:visited {
  color: #1976d2 !important;
  text-decoration: none;
}

  /* ê°€ë¡œ ë©”ë‰´ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
  .top-menu{
    margin-top:8px;
    border:1px solid #eee;
    background:#fafafa;
    padding:6px 10px;
    font-size:14px;
  }
  .top-menu ul{
    list-style:none;
    margin:0;
    padding:0;
    display:flex;
    align-items:center;
    flex-wrap:wrap;
    gap:0; /* í•­ëª© ì‚¬ì´ ê°„ê²©ì€ êµ¬ë¶„ìì—ì„œ ì²˜ë¦¬ */
  }
  .top-menu li{
    display:inline-block;
  }
  .top-menu li + li::before{
    content:"|";
    color:#aaa;
    margin:0 8px;
  }
  .top-menu a{
    text-decoration:none;   /* ë°‘ì¤„ ì œê±° */
    color:#333;
  }
  .top-menu a:hover{
    text-decoration:underline; /* ì›í•˜ë©´ ì œê±°í•´ë„ ë¨ */
  }


    .notice-inline{
    display:flex; align-items:center; gap:6px;
    padding:8px 12px; border:1px solid #eee; background:#fff; 
    white-space:nowrap; overflow:hidden;
  }
  .notice-title{ flex:1; min-width:0; }           /* ë§ì¤„ì„ ê°€ëŠ¥í•œ ì˜ì—­ */
  .notice-title ul{ margin:0; padding:0; list-style:none; }
  .notice-title li{ display:block; }              /* ìŠ¤í¬ë¦½íŠ¸ê°€ lië¥¼ ì±„ì›€ */
  .notice-title a{
    display:block; text-decoration:none; color:#333;
    overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  }

</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">



<!-- 2. flatpickr JS (â˜… ë¨¼ì € ë¶ˆëŸ¬ì™€ì•¼ í•¨) -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>


</head>
<body>

<!-- ë©êµ´ í…Œë‘ë¦¬ ì»¨í…Œì´ë„ˆê°€ í˜ì´ì§€ ë‚´ìš© ì „ì²´ ê°ì‹¸ê¸° -->
<div class="vine-border-container">
  <div class="text-bg"></div>

  <div class="vine-deco vine-top-left"></div>
  <div class="vine-deco vine-top-right"></div>
  <div class="vine-deco vine-bottom-left"></div>
  <div class="vine-deco vine-bottom-right"></div>












 <!-- ë ˆì´ì•„ì›ƒ: 1í–‰ 2ì¹¸ í…Œì´ë¸” -->
<table style="width:500px; border-collapse:collapse; table-layout:fixed;">
  <colgroup>
    <col style="width: 1fr;">
    <col style="width: 240px;"> <!-- ìš°ì¸¡ ë©”ë‰´ í­ -->
  </colgroup>
  <tr>
    <th colspan="2" style="text-align:center; padding:16px 0; font-size:28px;">
      íŠ¸ë¦¬ ë§Œì„¸ë ¥
    </th>
  </tr>
  <tr>



<!-- ê°€ë¡œ ë©”ë‰´: ë°‘ì¤„ ì œê±° + êµ¬ë¶„ì ìë™ -->
<nav class="top-menu">
  <ul>
    <li><a href="/index.html">ê³µì§€ê²Œì‹œíŒ</a></li>
    <li><a href="javascript:void(0)" onclick="window.open('/freeboard.html','free','width=1000,height=800,scrollbars=yes')">ì†Œí†µì°½</a></li>
    <li><a href="/faq.html">FAQ</a></li>
    <li><a href="/contact.html">ë¬¸ì˜í•˜ê¸°</a></li>
    <!-- ê´€ë¦¬ìë§Œ ë…¸ì¶œí•˜ë ¤ë©´ ê¸°ë³¸ì€ ìˆ¨ê¹€, ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë³´ì—¬ì£¼ê¸° -->
    <li><a id="admin-menu" href="/admin.html" style="display:none;">íšŒì›ê´€ë¦¬</a></li>
  </ul>
</nav>



  </tr>
</table>





<div class="notice-inline">
  <strong>ğŸ“Œ ê³µì§€ì‚¬í•­:&nbsp;</strong>
  <div class="notice-title">
    <ul id="notice-list"></ul> <!-- ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì—¬ê¸° ì±„ì›€ (ìµœì‹  1ê°œ) -->
  </div> <button id="add-btn" style="display:none;">ê³µì§€ ì¶”ê°€</button>
</div>
<!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì˜ì—­ -->
<div id="auth-section" class="auth-section" style="margin-top:20px;">
  <form id="login-form">
    <table class="auth-table">
      <tr>
        <!-- ì´ë©”ì¼ ì…ë ¥ -->
        <td>
          <input type="email" id="email" placeholder="ì´ë©”ì¼" style="padding:5px; width:120px;">
        </td>
        <!-- ë¡œê·¸ì¸ / íšŒì›ê°€ì… -->
        <td>
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" style="padding:5px; width:60px;">
          <button type="button" id="loginBtn" class="btn-success">ë¡œê·¸ì¸</button>
          <button type="button" id="signupBtn" class="btn-success" style="margin-left:8px; background-color:#fab7b7; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">íšŒì›ê°€ì…</button>
        </td>
      </tr>
      <tr>
        <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
<td style="text-align: right; color: blue;">
  ê°„í¸ë¡œê·¸ì¸:
</td>


  <td>
  <div class="social-login">
    <!-- êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ -->
    <img src="images/êµ¬ê¸€ë¡œê·¸ì¸.png" 
         alt="Google ë¡œê·¸ì¸" 
         class="login-btn" 
         id="googleLogin" />

    <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ -->
    <img src="images/ì¹´ì¹´ì˜¤ë¡œê·¸ì¸.png" 
         alt="Kakao ë¡œê·¸ì¸" 
         class="login-btn" 
         id="kakaoLogin" />
  </div>
</td>

      </tr>
    </table>
  </form>
</div>

<!-- ë¡œê·¸ì¸ í›„ í‘œì‹œ -->
<div id="profile-section" style="display:none; margin-top:8px;">
  <span id="user-nickname" style="font-weight:600; color: blue;"></span> ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤
 
  <button id="logoutBtn" type="button" style="margin-left:8px; background-color:#fab7b7; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button><br>
  <button id="toggle-history-btn" style="background-color:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ê³ ê°data</button>
  <button id="subscribeBtn" type="button" style="margin-left:8px;background-color:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ì •ê¸°êµ¬ë…</button>


<!-- íŒ¨ë„ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
<div id="saju-history-panel" style="display:none; margin-top:10px;">
  <!-- ê²€ìƒ‰ -->
  <div>
    <input type="text" id="search-name" placeholder="ì´ë¦„ ê²€ìƒ‰" style="background-color:#f7f4df; border:1px solid #ccc; padding:5px; border-radius:4px; width:60px;">
    <button id="search-btn" style="background-color:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ê²€ìƒ‰</button>
  </div>

  <!-- í…Œì´ë¸” -->
  <table border="1" width="100%" id="saju-history-table">
    <thead>
      <tr>
        <th>ì´ë¦„</th>
        <th>ìƒë…„ì›”ì¼</th>
        <th>ì„±ë³„</th>
        <th>ë“±ë¡ì¼</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- í˜ì´ì§€ ì»¨íŠ¸ë¡¤ -->
  <div style="margin-top:10px;">
    <button id="prev-page">ì´ì „</button>
    <span id="page-info">í˜ì´ì§€ 1</span>
    <button id="next-page">ë‹¤ìŒ</button>
  </div>
</div>


</div>

<!-- ê²°ì œ ëª¨ë‹¬ -->
<div id="subscriptionModal" style="display:none; margin-top:20px; border:1px solid #ccc; padding:16px;">
  <h3>ì •ê¸°êµ¬ë… ê²°ì œ</h3>
  <p>ì „í™”ë²ˆí˜¸ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ì œ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”.</p>
  <button onclick="startGoogleSubscription()">Google ì •ê¸°êµ¬ë… ê²°ì œ</button>
  <button onclick="startKakaoSubscription()">Kakao ì •ê¸°êµ¬ë… ê²°ì œ</button>
</div>











    <form id="saju-form">
      <label>ê³ ê°ëª…:</label>
<input type="text" id="customer-name" placeholder="ì €ì¥ê´€ë¦¬ìš©" style="background-color:#f7f4df; border:1px solid #ccc; padding:5px; border-radius:4px; width:60px;" />
 <label for="gender">ì„±ë³„:</label>
<select id="gender">
  <option value="">ì„ íƒ</option>
  <option value="male" >ë‚¨ì</option>
  <option value="female">ì—¬ì</option>
</select>
<button id="reset-btn" type="button" style="margin-left:8px; background-color:#fcfdd0; color:rgb(5, 1, 1); border:none; padding:5px 10px; border-radius:4px; cursor:pointer;" >ë‹¤ì‹œì…ë ¥</button>
<br />

    <label>ìƒë…„ì›”ì¼:</label> 
    <input  type="text" id="birth-date" placeholder="YYYYMMDD" class="birthdate-input" style="background-color:#f7dff5; border:1px solid #ccc; padding:5px; border-radius:4px; width:80px;"/>

    
    <select id="calendar-type" name="calendar-type">
      <option value="">ì„ íƒ</option>
                                    <option value="solar"  >ì–‘ë ¥</option>
      <option value="lunar">ìŒë ¥</option>
    </select>

<br />

    <label>ì¶œìƒ ì‹œê°„:</label>
                         <label><input type="radio" name="ampm" value="AM"> ì˜¤ì „</label>
    <label><input type="radio" name="ampm" value="PM"> ì˜¤í›„</label>
    <label>+</label>
    <select id="hour-select">
      <option value="ì„ íƒ"></option>
       <option value="0">0ì‹œ</option>
      <option value="1">1ì‹œ</option>
      <option value="2">2ì‹œ</option>
                                    <option value="3" >3ì‹œ</option>
      <option value="4">4ì‹œ</option>
      <option value="5">5ì‹œ</option>
      <option value="6">6ì‹œ</option>
      <option value="7">7ì‹œ</option>
      <option value="8" >8ì‹œ</option>
      <option value="9">9ì‹œ</option>
      <option value="10">10ì‹œ</option>
      <option value="11">11ì‹œ</option>
    </select>
<select id="minute-select">
  <option value="ì„ íƒ"></option>
  <option value="0">0ë¶„</option>
  <option value="1">1ë¶„</option>
  <option value="2">2ë¶„</option>
  <option value="3">3ë¶„</option>
  <option value="4">4ë¶„</option>
  <option value="5">5ë¶„</option>
  <option value="6">6ë¶„</option>
  <option value="7">7ë¶„</option>
  <option value="8">8ë¶„</option>
  <option value="9">9ë¶„</option>
                             <option value="10"  >10ë¶„</option>
  <option value="11">11ë¶„</option>
  <option value="12">12ë¶„</option>
  <option value="13">13ë¶„</option>
  <option value="14">14ë¶„</option>
  <option value="15">15ë¶„</option>
  <option value="16">16ë¶„</option>
  <option value="17">17ë¶„</option>
  <option value="18">18ë¶„</option>
  <option value="19">19ë¶„</option>
  <option value="20">20ë¶„</option>
  <option value="21">21ë¶„</option>
  <option value="22">22ë¶„</option>
  <option value="23">23ë¶„</option>
  <option value="24">24ë¶„</option>
  <option value="25">25ë¶„</option>
  <option value="26">26ë¶„</option>
  <option value="27">27ë¶„</option>
  <option value="28">28ë¶„</option>
  <option value="29">29ë¶„</option>
  <option value="30">30ë¶„</option>
  <option value="31">31ë¶„</option>
  <option value="32">32ë¶„</option>
  <option value="33">33ë¶„</option>
  <option value="34">34ë¶„</option>
  <option value="35">35ë¶„</option>
  <option value="36">36ë¶„</option>
  <option value="37">37ë¶„</option>
  <option value="38">38ë¶„</option>
  <option value="39">39ë¶„</option>
  <option value="40">40ë¶„</option>
  <option value="41">41ë¶„</option>
  <option value="42">42ë¶„</option>
  <option value="43">43ë¶„</option>
  <option value="44">44ë¶„</option>
  <option value="45">45ë¶„</option>
  <option value="46">46ë¶„</option>
  <option value="47">47ë¶„</option>
  <option value="48">48ë¶„</option>
  <option value="49">49ë¶„</option>
  <option value="50">50ë¶„</option>
  <option value="51">51ë¶„</option>
  <option value="52">52ë¶„</option>
  <option value="53">53ë¶„</option>
  <option value="54">54ë¶„</option>
  <option value="55">55ë¶„</option>
  <option value="56">56ë¶„</option>
  <option value="57">57ë¶„</option>
  <option value="58">58ë¶„</option>
  <option value="59">59ë¶„</option>
</select><br />

  <!-- ê¸°ì¡´ ë²„íŠ¼ -->
  <button type="button" id="sajuSubmit" class="btn-success">ì‚¬ì£¼ì‹ ì¶œë ¥</button>
  <button type="button" id="sinsalBtn" class="btn-success">ì‹ ì‚´ë³´ê¸°</button>
<span id="count-display"></span>
 
  </form>




<div class="note-box">
  â€» íƒœì–´ë‚œ ë¶„ëŒ€ê°€ 20~40ë¶„(30ë¶„ ê·¼ì²˜)ì— ìˆëŠ” ë¶„ì€ ì •í™•í•œ ì‹œì£¼ê°€ <br>ì‚°ì¶œë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ë”°ë¡œ í™•ì¸í•´ ì£¼ì„¸ìš”! <br>í•œêµ­ì¸ë¨¸íƒ€ì„ì€ ì ìš©ëœ ìƒíƒœì…ë‹ˆë‹¤. 
</div>
<div id="result" style="display:none;">

<!-- ê³µí†µ (í•­ìƒ í‘œì‹œ) -->
<div id="common-section">
  <div id="birth-info"></div>
  <div id="ganji-table"></div>
  <div id="today-saju-container" style="margin-top:30px;"></div>
</div>

<!-- ê¸°ë³¸ ëª¨ë“œ -->
<div id="basic-section" style="display:none;">
  <div id="dangryeong-table" class="dangryeong-table"></div>

  <!-- âœ… basic ì „ìš© ëŒ€ìš´/ì„¸ìš´ -->
  <div id="basic-daeyun-table" class="daeyun-table-container"></div>

</div>

<!-- ì‹ ì‚´ë¥˜ ëª¨ë“œ -->
<div id="sinsal-section" style="display:none;">
  <!-- âœ… sinsal ì „ìš© ëŒ€ìš´/ì„¸ìš´ -->
  <div id="sinsal-daeyun-table" class="daeyun-table-container"></div>
  

  <div id="sinsal-box"></div>
  <div id="etc-sinsal-box"></div>
</div>




  <div id="question-box" style="margin-top: 40px; padding: 20px; border-top: 1px solid #ccc;">
    <h3>ì§ˆë¬¸í•˜ê¸°</h3>
    <textarea id="question-input" placeholder="ê¶ê¸ˆí•œ ì ì„ ë¬¸ì˜í•˜ì„¸ìš”...(ë°˜ë“œì‹œ ì‚¬ì£¼ì¶œë ¥í›„ ì§ˆë¬¸í•˜ì„¸ìš”)" rows="8" style="width: 100%; padding: 10px;"></textarea>
    <br />
    <button id="send-email-button" style="margin-top: 10px; padding: 10px 20px;">ë³´ë‚´ê¸° (ì´ë©”ì¼)</button>
  </div>
</div>

  <div id="container"></div>  <!-- âœ… ì—¬ê¸°ì— ì¶œë ¥ -->
<!-- EmailJS SDK ì¶”ê°€ -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script type="module" src="app.js"></script>

<script>
  const buttons = document.querySelectorAll("#sajuSubmit, #sinsalBtn");

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      // ëª¨ë“  ë²„íŠ¼ì—ì„œ active ì œê±°
      buttons.forEach(b => b.classList.remove("active"));
      // í´ë¦­ëœ ë²„íŠ¼ì— active ì¶”ê°€
      btn.classList.add("active");
    });
  });
</script>





<!-- ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ -->

<script>
  const supabase = window.supabaseClient;

  // í† í°/ë¡¤ í—¬í¼
  const getToken = () =>
    localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
  const getRole = () =>
    (localStorage.getItem('userRole') || 'normal').toLowerCase();

  // ê³µì§€ ëª©ë¡ ë Œë” (ìµœì‹  1ê°œë§Œ)
  async function renderNotices() {
    const res = await fetch('/api/notice');
    const data = await res.json();

    const list = document.getElementById('notice-list');
    const addBtn = document.getElementById('add-btn');
    const role = getRole();

    // ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
    if (addBtn) addBtn.style.display = role === 'admin' ? 'inline' : 'none';

    list.innerHTML = '';

    // ìµœì‹  1ê°œë§Œ
    const n = Array.isArray(data) && data.length ? data[0] : null;
    if (!n) {
      const li = document.createElement('li');
      li.textContent = 'ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.';
      list.appendChild(li);
      return;
    }

    const li = document.createElement('li');
    li.innerHTML = `<a href="javascript:void(0)" onclick="openNotice(${n.id})">${n.title}</a>`;

    if (role === 'admin') {
      li.innerHTML += `
        <button onclick="editNotice(${n.id})">ìˆ˜ì •</button>
        <button onclick="deleteNotice(${n.id})">ì‚­ì œ</button>
      `;
    }

    list.appendChild(li);
  }

  // íŒì—…ìœ¼ë¡œ ê³µì§€ ìƒì„¸ ì—´ê¸°
  function openNotice(id) {
    window.open(
      `/notice.html?id=${id}`,
      'noticePopup',
      'width=600,height=400,resizable=yes,scrollbars=yes'
    );
  }

  // ê³µì§€ ì¶”ê°€ (ì œëª©+ë‚´ìš©)
  document.getElementById('add-btn')?.addEventListener('click', async () => {
    const title = prompt('ìƒˆ ê³µì§€ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:');
    if (title === null) return;
    const content = prompt('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:\n(ì¤„ë°”ê¿ˆ ê°€ëŠ¥)');
    if (content === null) return;

    const newTitle = title.trim();
    const newContent = (content ?? '').trim();
    if (!newTitle || !newContent) {
      alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    const token = getToken();
    const resp = await fetch('/api/notice', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        ...(token ? { Authorization: `Bearer ${token}` } : {})
      },
      body: JSON.stringify({ title: newTitle, content: newContent })
    });

    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      alert(err.error || 'ê³µì§€ ì¶”ê°€ ì‹¤íŒ¨(ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)');
      return;
    }

    renderNotices();
  });

  // ê³µì§€ ìˆ˜ì •: ì œëª©+ë‚´ìš© ëª¨ë‘ ë³€ê²½
  async function editNotice(id) {
    // í˜„ì¬ ë°ì´í„° ì¡°íšŒ
    const cur = await fetch(`/api/notice/${id}`).then(r => r.json());
    if (!cur || !cur.id) {
      alert('ê³µì§€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
      return;
    }

    const title = prompt('ìƒˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:', cur.title || '');
    if (title === null) return;

    const content = prompt('ìƒˆ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:\n(ì¤„ë°”ê¿ˆ ê°€ëŠ¥)', cur.content || '');
    if (content === null) return;

    const newTitle = title.trim();
    const newContent = (content ?? '').trim();
    if (!newTitle || !newContent) {
      alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    const token = getToken();
    const resp = await fetch(`/api/notice/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        ...(token ? { Authorization: `Bearer ${token}` } : {})
      },
      body: JSON.stringify({ title: newTitle, content: newContent })
    });

    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      alert(err.error || 'ê³µì§€ ìˆ˜ì • ì‹¤íŒ¨(ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)');
      return;
    }

    renderNotices();
  }

  // ê³µì§€ ì‚­ì œ
  async function deleteNotice(id) {
    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    const token = getToken();
    const resp = await fetch(`/api/notice/${id}`, {
      method: 'DELETE',
      headers: {
        ...(token ? { Authorization: `Bearer ${token}` } : {})
      }
    });

    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      alert(err.error || 'ê³µì§€ ì‚­ì œ ì‹¤íŒ¨(ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)');
      return;
    }

    renderNotices();
  }

  // ë¡œê·¸ì¸ UI ì—…ë°ì´íŠ¸ (role ì €ì¥/ì‚­ì œ ë° ë²„íŠ¼ ìƒíƒœ ë°˜ì˜)
  async function updateAuthUI(session) {
    const authSection =
      document.getElementById('auth-section') ||
      document.getElementById('login-form') ||
      document.querySelector('.login-form');
    const profileSection = document.getElementById('profile-section');
    const nicknameEl = document.getElementById('user-nickname');
    const historySection = document.getElementById('saju-history-section');

    if (session && session.user) {
      const token = session.access_token;
      const isMobile = /android|iphone|ipad|ipod/i.test(
        navigator.userAgent || ''
      );

      if (isMobile) localStorage.setItem('authToken', token);
      else sessionStorage.setItem('authToken', token);

      if (authSection) authSection.style.display = 'none';
      if (profileSection) profileSection.style.display = 'block';

      const user = session.user;

      // í”„ë¡œí•„ ë¶ˆëŸ¬ì™€ role ì €ì¥
      const { data: profile } = await supabase
        .from('profiles')
        .select('role, created_at, daily_limit')
        .eq('user_id', user.id)
        .single();

      const role = (profile?.role || 'normal').toLowerCase();
      localStorage.setItem('userRole', role); // ë¡œê·¸ì¸ ì‹œ ê°±ì‹ 
    } else {
      // ë¡œê·¸ì•„ì›ƒ ì‹œ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
      localStorage.removeItem('authToken');
      sessionStorage.removeItem('authToken');
      localStorage.removeItem('userRole');

      if (authSection) authSection.style.display = 'block';
      if (profileSection) profileSection.style.display = 'none';
      if (nicknameEl) nicknameEl.textContent = '';
      if (historySection) historySection.style.display = 'none';
    }

    // add-btn ì¦‰ì‹œ ë°˜ì˜
    const addBtn = document.getElementById('add-btn');
    if (addBtn) {
      addBtn.style.display = getRole() === 'admin' ? 'inline' : 'none';
    }
  }

  // ì´ˆê¸°/ë³€ê²½ ë™ì¼ íë¦„ìœ¼ë¡œ ê°±ì‹ 
  (async function init() {
    // ì´ˆê¸°ì—” ë²„íŠ¼ ìˆ¨ê¹€(ê¹œë¹¡ì„ ë°©ì§€)
    const addBtn = document.getElementById('add-btn');
    if (addBtn) addBtn.style.display = 'none';

    const { data: { session } } = await supabase.auth.getSession();
    await updateAuthUI(session);   // role ì €ì¥/ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 
    await renderNotices();         // role ë°˜ì˜ í›„ ëª©ë¡ ë Œë”

    supabase.auth.onAuthStateChange(async (_event, newSession) => {
      await updateAuthUI(newSession); // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒë§ˆë‹¤ role ê°±ì‹ 
      await renderNotices();          // ê·¸ë¦¬ê³  ëª©ë¡ ë‹¤ì‹œ ë Œë”
    });
  })();
</script>



<!-- ê´€ë¦¬ì ë©”ë‰´ê´€ë¦¬ -->
<script>
  // roleì— ë”°ë¼ ìš”ì†Œ í‘œì‹œ/ìˆ¨ê¹€
  function showIfAdmin(selector) {
    const el = document.querySelector(selector);
    if (!el) return;
    const role = (localStorage.getItem('userRole') || 'normal').toLowerCase();
    el.style.display = role === 'admin' ? 'inline' : 'none';
  }
</script>





<!-- ë¦¬ì…‹ë²„íŠ¼ì‘ë™ -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const resetBtn = document.getElementById("reset-btn");
  if (resetBtn) {
    resetBtn.addEventListener("click", () => {
      console.log("âœ… ë¦¬ì…‹ ë²„íŠ¼ ëˆŒë¦¼");

      // âœ… ì‚¬ì£¼ ì…ë ¥ í¼ ì „ì²´ ì´ˆê¸°í™”
      const form = document.getElementById("saju-form");
      if (form) form.reset();

      // âœ… ì¶œë ¥ ì „ì²´ ìˆ¨ê¸°ê¸° ë° ë‚´ìš© ì§€ìš°ê¸°
      const resultContainer = document.getElementById("result");
      if (resultContainer) {
        resultContainer.style.display = "none";

        // ë‚´ë¶€ ë‚´ìš©ë„ ì‹¹ ì§€ì›€
        const birthInfo = document.getElementById("birth-info");
        if (birthInfo) birthInfo.innerHTML = "";

        const ganjiTable = document.getElementById("ganji-table");
        if (ganjiTable) ganjiTable.innerHTML = "";

        const todaySaju = document.getElementById("today-saju-container");
        if (todaySaju) todaySaju.innerHTML = "";

        const dangryeong = document.getElementById("dangryeong-table");
        if (dangryeong) dangryeong.innerHTML = "";

        const basicDaeyun = document.getElementById("basic-daeyun-table");
        if (basicDaeyun) basicDaeyun.innerHTML = "";

        const sinsalDaeyun = document.getElementById("sinsal-daeyun-table");
        if (sinsalDaeyun) sinsalDaeyun.innerHTML = "";

        const sinsalBox = document.getElementById("sinsal-box");
        if (sinsalBox) sinsalBox.innerHTML = "";

        const etcSinsalBox = document.getElementById("etc-sinsal-box");
        if (etcSinsalBox) etcSinsalBox.innerHTML = "";
      }

      // âœ… íˆìŠ¤í† ë¦¬ ìˆ¨ê¸°ê¸°
      const historySection = document.getElementById("saju-history-section");
      if (historySection) historySection.style.display = "none";

      // âœ… ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  } else {
    console.log("âŒ reset-btn ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");
  }
});
</script>





</body>
</html>




