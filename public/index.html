 <!-- //         git add .
//               git commit -m "ë¡œê·¸ì¸íšŸìˆ˜ì œí•œ"   
//               git push origin main
//               git push
//               ê°•ì œì‹¤í–‰   vercel --prod --force

-->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />

<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet" />


<title>íŠ¸ë¦¬ ë§Œì„¸ë ¥</title>
  <!-- Supabase SDK -->
  <!-- (ë°”ê¾¼ í›„) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  
 <!-- 2) Supabase ì´ˆê¸°í™” (ì „ì—­ ë“±ë¡) -->
<script>
  if (!window.supabase) {
    alert("Supabase SDK ë¡œë“œ ì‹¤íŒ¨. ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” CDN ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
  }

  const userAgent = navigator.userAgent || navigator.vendor || window.opera;
  const isMobile = /android|iphone|ipad|ipod/i.test(userAgent);

  window.supabaseClient = window.supabase.createClient(
    "https://dxrgobsgeeshkybkbnxo.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR4cmdvYnNnZWVzaGt5YmtibnhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwOTAyNzIsImV4cCI6MjA3MzY2NjI3Mn0.vD1xSRezaTC2OUikZZJM7UntQaQWvOxRkvYiMl78UZA",
    {
      auth: {
        storage: isMobile ? window.localStorage : window.sessionStorage,
        autoRefreshToken: true,
        persistSession: true,
        detectSessionInUrl: true,
      },
    }
  );

  // í˜¸í™˜ìš©
  window.client = window.supabaseClient;
  console.log("[INDEX] supabaseClient ready:", !!window.supabaseClient);
</script>
  <script src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>

<style>
body {
  font-family: 'Nanum Gothic', sans-serif;
  margin: 0;
  padding: 0;
  background-color: #ffffff;
}

/* ì‚¬ì£¼íŠ¸ë¦¬ë‚˜ë¬´ ê·¸ë¦¼ */
.landing-wrap {
  display: flex;
  gap: 24px;
  align-items: flex-start;
  margin-top: 8px;

  /* ê³ ì •ëœ ê·¸ë¦¼ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì¢Œì¸¡ ì—¬ë°± í™•ë³´ */
  padding-left: clamp(120px, 22vw, 240px);
}

/* â¬‡ï¸ sticky â†’ fixed ë¡œ êµì²´: ì¢Œí•˜ë‹¨ ê³ ì • */
.hero-left {
  position: fixed !important;
  left: max(12px, env(safe-area-inset-left));
  bottom: max(12px, env(safe-area-inset-bottom));
  top: auto !important;
  z-index: 2147483000; /* í•­ìƒ ìµœìƒë‹¨ì— */
  pointer-events: none; /* í´ë¦­ì´ ë’¤ ì»¨í…ì¸ ë¡œ í†µê³¼ë˜ê²Œ (ì›í•˜ë©´ ì œê±°) */
}

/* ì´ë¯¸ì§€ í¬ê¸°/ëª¨ì„œë¦¬ */
.hero-left img {
  display: block;
  width: clamp(120px, 22vw, 240px);
  height: auto;
  border-radius: 14px;
  box-shadow: none;
  background-color: transparent;
  pointer-events: auto; /* ì´ë¯¸ì§€ëŠ” í´ë¦­ ê°€ëŠ¥í•˜ê²Œ (í•„ìš” ì—†ìœ¼ë©´ ì œê±°) */
}

/* ì˜¤ë¥¸ìª½ ì˜ì—­ì€ ê·¸ëŒ€ë¡œ */
.hero-right {
  flex: 1.25;
  min-width: 360px;
}

/* ëª¨ë°”ì¼ì—ì„œë„ ì¢Œí•˜ë‹¨ ê³ ì • ìœ ì§€ + ì¡°ê¸ˆ ë” ì‘ê²Œ */
@media (max-width: 900px) {
  .landing-wrap {
    display: block;
    padding-left: clamp(100px, 30vw, 160px);
  }
  .hero-left img {
    width: clamp(100px, 30vw, 160px);
  }
}

  /* êµ¬ë¶„ì„  */
.section-split{
  border:0;
  border-top:1px solid #0f6105; /* ì—°í•œ íšŒìƒ‰ */
  margin:20px 0;                /* ìœ„ì•„ë˜ ê°„ê²© */
}


  /* ì œëª©, í¼ ìŠ¤íƒ€ì¼ */
  h1 {
    margin-top: 0;
    color: #222;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.25);
  }

  form#saju-form {
    margin-top: 20px;
  }

  /* ê²°ê³¼ ë° ì§ˆë¬¸ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
  #result,
  #sewoon,
  #today-saju-container,
  #question-box {
    background-color: rgba(255, 255, 255, 0.9);
    padding: 15px;
    margin-top: 20px;
    border-radius: 8px;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
    color: #222;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  }

  /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ (ê²°ê³¼ ë‚´ë¶€ í…Œì´ë¸”ìš©) */
  #result table,
  #sewoon table,
  #today-saju-container table {
    width: 100%;
    border-collapse: collapse;
  }
  #result table th,
  #result table td,
  #sewoon table th,
  #sewoon table td,
  #today-saju-container table th,
  #today-saju-container table td {
    padding: 8px 12px;
    border: 1px solid #ccc;
    background-color: transparent;
    color: #222;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  }
.btn-success {
  background-color: #28a745;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
}

.btn-success:hover {
  background-color: #218838;
}
.sewoon-cell.selected {
  background-color: #dff0d8; /* ì—°í•œ ì—°ë‘ìƒ‰ */
  border: 2px solid #28a745;
  box-shadow: 0 0 4px rgba(40,167,69,0.5);
}

  .green { color: green; font-weight: bold; }
  .red { color: red; font-weight: bold; }

    #sinsal-box table td {
      text-align: center;
      vertical-align: middle;
    }

#sinsal-box table {
  margin-left: auto;
  margin-right: auto;
}

#basic-section, #sinsal-section {
  display: none;
}

.explainable { cursor: pointer !important; }
.explainable::after { display: none !important; }


.tooltip {
  position: relative;
  cursor: pointer;
}

.tooltip::after {
  content: attr(data-desc);
  position: absolute;
  background: #333;
  color: #fff;
  padding: 6px 10px;
  border-radius: 4px;
  font-size: 13px;
  z-index: 9999;

  /* ì—¬ëŸ¬ ì¤„ ì¶œë ¥ ê°€ëŠ¥ */
  white-space: normal;
  word-break: keep-all;   /* ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ (ë„ì–´ì“°ê¸° ê¸°ì¤€) */
  max-width: 600px;       /* ì¤„ë°”ê¿ˆ ë°œìƒí•  ìµœëŒ€ í­ */
  line-height: 1.5;
  text-align: left;

  /* ìœ„ì¹˜: ìš”ì†Œ ìœ„ìª½ ì¤‘ì•™ */
  bottom: 120%;
  left: 50%;
  transform: translateX(-50%);

  display: block;         /* âœ… ì„¸ë¡œ í•œì¤„ ë¬¸ì œ ë°©ì§€ */
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}

.tooltip:hover::after {
  opacity: 1;
}

.nackhwa-table {
  border-collapse: collapse !important;   /* âœ… ìƒìœ„ í…Œì´ë¸” ì†ì„± ë¬´ì‹œ */
  width: 100%;
}

.nackhwa-table td,
.nackhwa-table th {
  border: 1px solid #999 !important;      /* âœ… ë‚´ë¶€ ì¹¸ ì„  ê°•ì œ í‘œì‹œ */
  padding: 2px;
}

      .parent #nackhwaPopup .nackhwa-table td,
.parent #nackhwaPopup .nackhwa-table th {
  border: 1px solid #999 !important;
}

#nackhwaPopup {
  width: auto !important;      /* âœ… ìë™ í¬ê¸° */
  min-width: unset !important; /* âœ… ê¸°ë³¸ ì œí•œ í•´ì œ */
  max-width: none !important;  /* âœ… ìµœëŒ€í­ ì œí•œ í•´ì œ */
  height: auto !important;     /* âœ… ë†’ì´ë„ ìë™ */
  white-space: nowrap;         /* âœ… ì¤„ë°”ê¿ˆ ë°©ì§€ */
}

.btn-success.active {
  background-color: #f18997; 
  color: #fff;
}

/* ê³ ê° ì´ë ¥ í‘œ ì „ì²´ */
#saju-history-table {
  width: 100%;
  border-collapse: collapse; /* ì´ì¤‘ì„  ì œê±° */
  font-size: 14px;
  margin-top: 10px;
}

/* ì…€ ê³µí†µ ìŠ¤íƒ€ì¼ */
#saju-history-table th,
#saju-history-table td {
  border: 1px solid #e0e0e0;
  padding: 8px 12px;
  text-align: center;
}

/* í—¤ë” ì¤„ */
#saju-history-table th {
  background-color: #f8f9fa;
  font-weight: bold;
}

/* ì¤„ë¬´ëŠ¬ íš¨ê³¼ */
#saju-history-table tr:nth-child(even) {
  background-color: #fcfcfc;
}

/* hover íš¨ê³¼ */
#saju-history-table tr:hover {
  background-color: #f1f7ff;
}

/* ì´ë¦„ í´ë¦­ ë§í¬ */
.saju-record-link {
  cursor: pointer;
  color: #007bff;
  text-decoration: underline;
}

/* ì‚­ì œ ë²„íŠ¼ */
.delete-record-btn {
  background: #ff4d4f;
  border: none;
  color: white;
  padding: 5px 10px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
}
.delete-record-btn:hover {
  background: #d9363e;
}




#page-info {
  margin-top: 12px;
  text-align: center;   /* âœ… ì „ì²´ ê°€ìš´ë° ì •ë ¬ */
}

.page-btn,
.page-num {
  margin: 0 2px;          /* âœ… ê°„ê²© ì¤„ì„ */
  padding: 2px 4px;       /* âœ… ì•ˆìª½ ì—¬ë°±ë„ ì¤„ì„ */
  border: none;
  background: none;
  cursor: pointer;
  font-size: 14px;
  color: #000;            /* ê¸°ë³¸ ê²€ì •ìƒ‰ */
}

.page-btn:hover,
.page-num:hover {
  text-decoration: underline;
}

.page-num.active {
  font-weight: bold;
  color: red;             /* âœ… í˜„ì¬ í˜ì´ì§€ë§Œ ë¹¨ê°• */
  text-decoration: none;
}


  /* ê³µì§€ 1ì¤„: ê¸¸ë©´ ë§ì¤„ì„ */
.notice-bar{
  display:flex; align-items:center;
  padding:8px 12px; border:1px solid #eee; background:#fff; font-size:14px;
}
.notice-bar .label{ flex:0 0 auto; }
.notice-bar .title{
  flex:1 1 auto; min-width:0;               /* â† í•µì‹¬: ê³µê°„ ìµœëŒ€ í™œìš© */
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
#latest-notice,
#latest-notice:visited {
  color: #1976d2 !important;
  text-decoration: none;
}

  /* ê°€ë¡œ ë©”ë‰´ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
  .top-menu{
    margin-top:8px;
    border:1px solid #eee;
    background:#fafafa;
    padding:6px 10px;
    font-size:14px;
  }
  .top-menu ul{
    list-style:none;
    margin:0;
    padding:0;
    display:flex;
    align-items:center;
    flex-wrap:wrap;
    gap:0; /* í•­ëª© ì‚¬ì´ ê°„ê²©ì€ êµ¬ë¶„ìì—ì„œ ì²˜ë¦¬ */
  }
  .top-menu li{
    display:inline-block;
  }
  .top-menu li + li::before{
    content:"|";
    color:#aaa;
    margin:0 8px;
  }
  .top-menu a{
    text-decoration:none;   /* ë°‘ì¤„ ì œê±° */
    color:#333;
  }
  .top-menu a:hover{
    text-decoration:underline; /* ì›í•˜ë©´ ì œê±°í•´ë„ ë¨ */
  }


    .notice-inline{
    display:flex; align-items:center; gap:6px;
    padding:8px 12px; border:1px solid #eee; background:#fff; 
    white-space:nowrap; overflow:hidden;
  }
  .notice-title{ flex:1; min-width:0; }           /* ë§ì¤„ì„ ê°€ëŠ¥í•œ ì˜ì—­ */
  .notice-title ul{ margin:0; padding:0; list-style:none; }
  .notice-title li{ display:block; }              /* ìŠ¤í¬ë¦½íŠ¸ê°€ lië¥¼ ì±„ì›€ */
  .notice-title a{
    display:block; text-decoration:none; color:#333;
    overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  }

  /* ê³µì§€ í´ë¦­ ì‹œ íŒŒë€ìƒ‰ ê°•ì¡° */
  /* í´ë¦­ëœ ì•„ë˜ìª½ ëª©ë¡ ì œëª© ìƒ‰ìƒ */
  .notice-item.active a {
    color: #0b57d0;
    font-weight: 600;
    text-decoration: underline;
  }

/* ì ‘íŒ ìƒíƒœ (ì™„ì „ ìˆ¨ê¹€) */
#profile-edit-panel{
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  padding: 0 !important;          /* â† í•œ ì¤„ ì”ìƒ ì œê±° í•µì‹¬ */
  border-width: 0 !important;     /* â† í…Œë‘ë¦¬ë„ ì œê±° */
  margin-top: 0 !important;       /* â† ìœ„ ì—¬ë°± ì œê±° */
  pointer-events: none;

  /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ */
  transition:
    max-height .25s ease,
    padding .2s ease,
    margin .2s ease,
    opacity .2s ease,
    border-width .2s ease;
}

/* í¼ì¹œ ìƒíƒœë§Œ ë³´ì´ê²Œ */
#profile-edit-panel.open{
  max-height: 420px;
  opacity: 1;
  padding: 12px !important;
  border: 1px solid #ddd !important;
  margin-top: 12px !important;
  pointer-events: auto;
  background: #fafafa;            /* í•„ìš” ì‹œ ìœ ì§€ */
  border-radius: 8px;             /* í•„ìš” ì‹œ ìœ ì§€ */
}

/* ìƒë‹¨ í—¤ë” ì „ì²´ íŒŒë€ í†¤ */
#unseong-block .unseong-table .tophead th { background: #e9f5ff !important; }

/* ì¤‘ê°„ í—¤ë”(ì§€ì§€ ê°’ ë¼ì¸)ëŠ” ê·¸ëŒ€ë¡œ ë…¸ë‘ */
#unseong-block .unseong-table thead tr.midhead th {
  background: #fff7d6 !important;
}

#term-help-pop { pointer-events: none; }

</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">



<!-- 2. flatpickr JS (â˜… ë¨¼ì € ë¶ˆëŸ¬ì™€ì•¼ í•¨) -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>


</head>
<body>







<!-- ì²« <table> ë°”ë¡œ ìœ„ì— ì¶”ê°€ -->
<div class="landing-wrap">
  <div class="hero-left">
    <picture>
      <source srcset="/images/tree-hero.webp" type="image/webp" />
      <img src="/images/tree-hero.jpg"
           alt="ì† ìœ„ì— ë¿Œë¦¬ë¥¼ ë‚´ë¦° ë‚˜ë¬´"
           width="900" height="700"
           loading="lazy" decoding="async"
           style="max-width:100%;height:auto;" />
    </picture>
  </div>
  <div class="hero-right">




 <!-- ë ˆì´ì•„ì›ƒ: 1í–‰ 2ì¹¸ í…Œì´ë¸” -->
<table style="width:500px; border-collapse:collapse; table-layout:fixed;">
  <colgroup>
    <col style="width: 1fr;">
    <col style="width: 240px;"> <!-- ìš°ì¸¡ ë©”ë‰´ í­ -->
  </colgroup>
  <tr>
    <th colspan="2" style="text-align:left; padding:16px 0; font-size:28px;">
      íŠ¸ë¦¬ ë§Œì„¸ë ¥
    </th>
  </tr>
  <tr>



<!-- ê°€ë¡œ ë©”ë‰´: ë°‘ì¤„ ì œê±° + êµ¬ë¶„ì ìë™ -->
<nav class="top-menu">
  <ul>
    <li><a href="/index.html">ê³µì§€ê²Œì‹œíŒ</a></li>
<li>
  <a href="javascript:void(0)"
     onclick="window.open('https://cafe.naver.com/f-e/cafes/22418538/menus/288?t=1758692524163',
                          'free',
                          'width=1200,height=800,scrollbars=yes')">
     ì†Œí†µì°½
  </a>
</li>


<li>
  <a href="javascript:void(0)"
     onclick="window.open('https://cafe.naver.com/f-e/cafes/22418538/menus/327?t=1758693680522',
                          'faq',
                          'width=1200,height=800,scrollbars=yes')">
     FAQ
  </a>
</li>

<li>
  <a href="javascript:void(0)"
     onclick="window.open('https://cafe.naver.com/f-e/cafes/22418538/menus/328?t=1758693700672',
                          'contact',
                          'width=1200,height=800,scrollbars=yes')">
     ë¬¸ì˜í•˜ê¸°
  </a>
</li>

<li><a id="admin-menu" href="javascript:void(0)" 
       onclick="window.open('/member-admin.html','memberAdmin','width=1400,height=800,scrollbars=yes')" 
       style="display:none;">
  íšŒì›ê´€ë¦¬
</a></li>


  </ul>
</nav>



  </tr>
</table>





<div class="notice-inline">
  <strong>ğŸ“Œ ê³µì§€ì‚¬í•­:&nbsp;</strong>
  <div class="notice-title">
    <ul id="notice-list"></ul> <!-- ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì—¬ê¸° ì±„ì›€ (ìµœì‹  1ê°œ) -->
  </div> <button id="add-btn" style="display:none;">ê³µì§€ ì¶”ê°€</button>
</div>
<!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì˜ì—­ -->
<div id="auth-section" class="auth-section" style="margin-top:20px;">
  <form id="login-form">
    <table class="auth-table">
      <tr>
        <!-- ì´ë©”ì¼ ì…ë ¥ -->
        <td>
          <input type="email" id="email" placeholder="ì´ë©”ì¼" style="padding:5px; width:120px;">
        </td>
        <!-- ë¡œê·¸ì¸ / íšŒì›ê°€ì… -->
        <td>
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" style="padding:5px; width:60px;">
          <button type="button" id="loginBtn" class="btn-success">ë¡œê·¸ì¸</button>
          <button type="button" id="signupBtn" class="btn-success" style="margin-left:8px; background-color:#fab7b7; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">íšŒì›ê°€ì…</button>
        </td>
      </tr>
      <tr>
        <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
<td style="text-align: right; color: blue;">
  ê°„í¸ë¡œê·¸ì¸:
</td>


  <td>
  <div class="social-login">
    <!-- êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ -->
    <img src="images/êµ¬ê¸€ë¡œê·¸ì¸.png" 
         alt="Google ë¡œê·¸ì¸" 
         class="login-btn" 
         id="googleLogin" />

    <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ -->
    <img src="images/ì¹´ì¹´ì˜¤ë¡œê·¸ì¸.png" 
         alt="Kakao ë¡œê·¸ì¸" 
         class="login-btn" 
         id="kakaoLogin" />
  </div>
</td>

      </tr>
    </table>
  </form>
</div>

<!-- ë¡œê·¸ì¸ í›„ í‘œì‹œ -->
<div id="profile-section" style="display:none; margin-top:8px;">
    <span id="user-badge" style="margin-right:6px; font-weight:700;"></span>
  <span id="user-nickname" style="font-weight:600; color: blue;"></span> ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤
 
  <button id="logoutBtn" type="button" style="margin-left:8px; background-color:#fab7b7; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
   <!-- íšŒì›ì •ë³´ ìˆ˜ì • ë²„íŠ¼ -->
  <button id="editProfileBtn" type="button" style="margin-left:8px;">
    íšŒì›ì •ë³´ ìˆ˜ì •
  </button>

  <!-- ë“œë¡­(ìŠ¬ë¼ì´ë“œ) íŒ¨ë„: í”„ë¡œí•„ ìˆ˜ì • -->
<!-- ë“œë¡­(ìŠ¬ë¼ì´ë“œ) íŒ¨ë„: í”„ë¡œí•„ ìˆ˜ì • -->
<div id="profile-edit-panel" class="collapse" aria-hidden="true"
     style="display:none; margin-top:12px; padding:12px; border:1px solid #ddd; border-radius:8px; background:#fafafa;">
  <div style="display:flex; gap:16px; flex-wrap:wrap; align-items:flex-end;">
 <label style="display:flex; flex-direction:column;">
  <span>ë‹‰ë„¤ì„</span>
  <input id="my-nickname" type="text" placeholder="ë‹‰ë„¤ì„" style="margin-top:6px;">
</label>


    <label style="display:flex; flex-direction:column;">
      <span>ì´ë©”ì¼</span>
      <input id="my-email" type="email" placeholder="you@example.com" style="margin-top:6px;" readonly>
    </label>

    <label style="display:flex; flex-direction:column;">
      <span>ì „í™”ë²ˆí˜¸</span>
      <input id="my-phone" type="tel" placeholder="010-1234-5678" style="margin-top:6px;">
    </label>

    <div style="min-width:140px;">
      <div><strong>íšŒì›ë“±ê¸‰</strong> : <span id="my-grade">-</span></div>
      <div><strong>1ì¼ ì¹´ìš´íŠ¸</strong> : <span id="my-daily-count">-</span></div>
    </div>
  </div>

  <div style="margin-top:10px;">
    <button id="my-profile-save"   type="button" style="background:#3b82f6; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;">ì €ì¥</button>
    <button id="my-profile-cancel" type="button" style="margin-left:6px; border:1px solid #ddd; padding:6px 10px; border-radius:6px; cursor:pointer;">ë‹«ê¸°</button>
  </div>
</div>

  <br>
  <button id="toggle-history-btn" style="background-color:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ê³ ê°data</button>
  <button id="subscribeBtn" type="button" style="margin-left:8px;background-color:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ì •ê¸°êµ¬ë… ë° ê²°ì œ ì •ë³´</button>


<!-- íŒ¨ë„ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
<div id="saju-history-panel" style="display:none; margin-top:10px;">
  <!-- ê²€ìƒ‰ -->
  <div>
    <input type="text" id="search-name" placeholder="ì´ë¦„ ê²€ìƒ‰" style="background-color:#f7f4df; border:1px solid #ccc; padding:5px; border-radius:4px; width:60px;">
    <button id="search-btn" style="background-color:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ê²€ìƒ‰</button>
  </div>

  <!-- í…Œì´ë¸” -->
  <table border="1" width="100%" id="saju-history-table">
    <thead>
      <tr>
        <th>ì´ë¦„</th>

        <th>ìƒë…„ì›”ì¼</th>
                  <th>ë‹¬ë ¥</th>   <!-- â† ì¶”ê°€: ìŒë ¥/ì–‘ë ¥ -->
        <th>ì„±ë³„</th>
        <th>ë“±ë¡ì¼</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- í˜ì´ì§€ ì»¨íŠ¸ë¡¤ -->
  <div style="margin-top:10px;">
    <button id="prev-page">ì´ì „</button>
    <span id="page-info">í˜ì´ì§€ 1</span>
    <button id="next-page">ë‹¤ìŒ</button>
  </div>
</div>


</div>

<div id="subscriptionModal" style="display:none; margin-top:20px; border:1px solid #ccc; padding:16px;"></div>










    <form id="saju-form">
      <label>ê³ ê°ëª…:</label>
<input type="text" id="customer-name" placeholder="ì €ì¥ê´€ë¦¬ìš©" style="background-color:#f7f4df; border:1px solid #ccc; padding:5px; border-radius:4px; width:60px;" />
 <label for="gender">ì„±ë³„:</label>
<select id="gender">
  <option value="">ì„ íƒ</option>
  <option value="male" >ë‚¨ì</option>
  <option value="female">ì—¬ì</option>
</select>
<button id="reset-btn" type="button" style="margin-left:8px; background-color:#fcfdd0; color:rgb(5, 1, 1); border:none; padding:5px 10px; border-radius:4px; cursor:pointer;" >ë‹¤ì‹œì…ë ¥</button>
<br />

    <label>ìƒë…„ì›”ì¼:</label> 
    <input  type="text" id="birth-date" placeholder="YYYYMMDD" class="birthdate-input" style="background-color:#f7dff5; border:1px solid #ccc; padding:5px; border-radius:4px; width:80px;"/>

    
    <select id="calendar-type" name="calendar-type">
      <option value="">ì„ íƒ</option>
                                    <option value="solar"  >ì–‘ë ¥</option>
      <option value="lunar">ìŒë ¥</option>
    </select>

<br />

    <label>ì¶œìƒ ì‹œê°„:</label>
                         <label><input type="radio" name="ampm" value="AM"> ì˜¤ì „</label>
    <label><input type="radio" name="ampm" value="PM"> ì˜¤í›„</label>
    <label>+</label>
    <select id="hour-select">
      <option value="ì„ íƒ"></option>
       <option value="0">0ì‹œ</option>
      <option value="1">1ì‹œ</option>
      <option value="2">2ì‹œ</option>
                                    <option value="3" >3ì‹œ</option>
      <option value="4">4ì‹œ</option>
      <option value="5">5ì‹œ</option>
      <option value="6">6ì‹œ</option>
      <option value="7">7ì‹œ</option>
      <option value="8" >8ì‹œ</option>
      <option value="9">9ì‹œ</option>
      <option value="10">10ì‹œ</option>
      <option value="11">11ì‹œ</option>
    </select>
<select id="minute-select">
  <option value="ì„ íƒ"></option>
  <option value="0">0ë¶„</option>
  <option value="1">1ë¶„</option>
  <option value="2">2ë¶„</option>
  <option value="3">3ë¶„</option>
  <option value="4">4ë¶„</option>
  <option value="5">5ë¶„</option>
  <option value="6">6ë¶„</option>
  <option value="7">7ë¶„</option>
  <option value="8">8ë¶„</option>
  <option value="9">9ë¶„</option>
                             <option value="10"  >10ë¶„</option>
  <option value="11">11ë¶„</option>
  <option value="12">12ë¶„</option>
  <option value="13">13ë¶„</option>
  <option value="14">14ë¶„</option>
  <option value="15">15ë¶„</option>
  <option value="16">16ë¶„</option>
  <option value="17">17ë¶„</option>
  <option value="18">18ë¶„</option>
  <option value="19">19ë¶„</option>
  <option value="20">20ë¶„</option>
  <option value="21">21ë¶„</option>
  <option value="22">22ë¶„</option>
  <option value="23">23ë¶„</option>
  <option value="24">24ë¶„</option>
  <option value="25">25ë¶„</option>
  <option value="26">26ë¶„</option>
  <option value="27">27ë¶„</option>
  <option value="28">28ë¶„</option>
  <option value="29">29ë¶„</option>
  <option value="30">30ë¶„</option>
  <option value="31">31ë¶„</option>
  <option value="32">32ë¶„</option>
  <option value="33">33ë¶„</option>
  <option value="34">34ë¶„</option>
  <option value="35">35ë¶„</option>
  <option value="36">36ë¶„</option>
  <option value="37">37ë¶„</option>
  <option value="38">38ë¶„</option>
  <option value="39">39ë¶„</option>
  <option value="40">40ë¶„</option>
  <option value="41">41ë¶„</option>
  <option value="42">42ë¶„</option>
  <option value="43">43ë¶„</option>
  <option value="44">44ë¶„</option>
  <option value="45">45ë¶„</option>
  <option value="46">46ë¶„</option>
  <option value="47">47ë¶„</option>
  <option value="48">48ë¶„</option>
  <option value="49">49ë¶„</option>
  <option value="50">50ë¶„</option>
  <option value="51">51ë¶„</option>
  <option value="52">52ë¶„</option>
  <option value="53">53ë¶„</option>
  <option value="54">54ë¶„</option>
  <option value="55">55ë¶„</option>
  <option value="56">56ë¶„</option>
  <option value="57">57ë¶„</option>
  <option value="58">58ë¶„</option>
  <option value="59">59ë¶„</option>
</select><br />

  <!-- ê¸°ì¡´ ë²„íŠ¼ -->
  <button type="button" id="sajuSubmit" class="btn-success">ì‚¬ì£¼ì •ë³´ ì¶œë ¥</button>
  <button type="button" id="sinsalBtn" class="btn-success">12ìš´ì„±[12ì‹ ì‚´]</button>
<br><span id="count-display"></span>
 
  </form>




<div class="note-box">
  â€» íƒœì–´ë‚œ ë¶„ëŒ€ê°€ 20~40ë¶„(30ë¶„ ê·¼ì²˜)ì— ìˆëŠ” ë¶„ì€ ì •í™•í•œ ì‹œì£¼ê°€ ì‚°ì¶œë˜ì§€ ì•Šì„ ìˆ˜ë„ <br>ìˆìœ¼ë‹ˆ ë”°ë¡œ í™•ì¸í•´ ì£¼ì„¸ìš”! í•œêµ­ì¸ë¨¸íƒ€ì„ì€ ì ìš©ëœ ìƒíƒœì…ë‹ˆë‹¤.
  <br>
  <span class="note-links">
    <a href="/terms1.html">ì´ìš©ì•½ê´€</a> |
    <a href="/privacy1.html">ê°œì¸ì •ë³´ì·¨ê¸‰ë°©ì¹¨</a> |
    <a href="/business-info1.html">ì‚¬ì—…ìì •ë³´í™•ì¸</a>
  </span>
</div>


</div>




  </div><!-- /.hero-right -->
</div><!-- /.landing-wrap -->



















<!-- ì´í•˜ ì‚¬ì£¼ë°ì´í„° ì¶œë ¥ë¶€ -->
<div id="result" style="display:none;">
<hr class="section-split">
<!-- ê³µí†µ (í•­ìƒ í‘œì‹œ) -->
<div id="common-section">
  <div id="birth-info"></div>
  <div id="ganji-table"></div>
  <div id="today-saju-container" style="margin-top:30px;"></div>
</div>

<!-- ê¸°ë³¸ ëª¨ë“œ -->
<div id="basic-section" style="display:none;">
  <div id="dangryeong-table" class="dangryeong-table"></div>

  <!-- âœ… basic ì „ìš© ëŒ€ìš´/ì„¸ìš´ -->
  <div id="basic-daeyun-table" class="daeyun-table-container"></div>

</div>

<!-- ì‹ ì‚´ë¥˜ ëª¨ë“œ -->
<div id="sinsal-section" style="display:none;">
  <!-- âœ… sinsal ì „ìš© ëŒ€ìš´/ì„¸ìš´ -->
  <div id="sinsal-daeyun-table" class="daeyun-table-container"></div>
  

  <div id="sinsal-box"></div>
  <div id="etc-sinsal-box"></div>
</div>




  <div id="question-box" style="margin-top: 40px; padding: 20px; border-top: 1px solid #ccc;">
    <h3>ì§ˆë¬¸í•˜ê¸°</h3>
    <textarea id="question-input" placeholder="ê¶ê¸ˆí•œ ì ì„ ë¬¸ì˜í•˜ì„¸ìš”...(ë°˜ë“œì‹œ ì‚¬ì£¼ì¶œë ¥í›„ ì§ˆë¬¸í•˜ì„¸ìš”)" rows="8" style="width: 100%; padding: 10px;"></textarea>
    <br />
    <button id="send-email-button" style="margin-top: 10px; padding: 10px 20px;">ë³´ë‚´ê¸° (ì´ë©”ì¼)</button>
  </div>

<!-- ì§ˆë¬¸í•˜ê¸° ë°•ìŠ¤ ì•„ë˜ì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸° -->
<div id="biz-info" itemscope itemtype="https://schema.org/Organization"
     style="margin-top: 40px; padding: 20px; border-top: 1px solid #ccc; font-size: 14px; line-height: 1.6;">
  <h3 style="margin: 0 0 12px 0; font-size: 16px;">ì‚¬ì—…ì ì •ë³´</h3>

  <!-- ê·¸ë¦¬ë“œ -->
  <div style="
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px 16px;
    ">
    <div style="display:flex; gap:8px;">
      <div style="min-width: 110px; color:#666;">ìƒí˜¸ëª…</div>
      <div itemprop="name"><strong>íŠ¸ë¦¬ì‚¬ì£¼</strong></div>
    </div>

    <div style="display:flex; gap:8px;">
      <div style="min-width: 110px; color:#666;">ëŒ€í‘œìëª…</div>
      <div itemprop="founder">ìœ ì„¬ê·¼</div>
    </div>

    <div style="display:flex; gap:8px;">
      <div style="min-width: 110px; color:#666;">ì‚¬ì—…ì¥ì£¼ì†Œ</div>
      <div itemprop="address" itemscope itemtype="https://schema.org/PostalAddress">
        ì„œìš¸ì‹œ ì†¡íŒŒêµ¬ ë²•ì›ë¡œ4ê¸¸ 10 íìŠ¤í…Œì´íŠ¸ì—ì½”ë¬¸ì • 1125
        <span itemprop="streetAddress"></span>
      </div>
    </div>

    <div style="display:flex; gap:8px;">
      <div style="min-width: 110px; color:#666;">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</div>
      <div>795-40-01592</div>
    </div>

    <div style="display:flex; gap:8px;">
      <div style="min-width: 110px; color:#666;">ëŒ€í‘œì „í™”ë²ˆí˜¸</div>
      <div>
          010-4749-2139
        </a>
      </div>
    </div>

    <div style="display:flex; gap:8px;">
      <div style="min-width: 110px; color:#666;">ëŒ€í‘œì´ë©”ì¼</div>
      <div>
        <a href="mailto:" itemprop="email" style="color:inherit; text-decoration:underline;">
          yyulss@naver.com
        </a>
      </div>
    </div>
  </div>

  <!-- ê°€ë¡œì„  & ì•ˆë‚´ -->
  <div style="margin-top: 12px; border-top: 1px dashed #ddd; padding-top: 8px; color:#888;">
    â€» ë³¸ í˜ì´ì§€ì˜ ëª¨ë“  ë¬¸ì˜ëŠ” ìƒë‹¨ â€˜ì§ˆë¬¸í•˜ê¸°â€™ë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”.
  </div>
</div>

<!-- ë°˜ì‘í˜•(ë„“ì€ í™”ë©´ì—ì„œ 2ì—´) â€” ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë§Œ ì“°ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ <style>ì€ ìƒëµ ê°€ëŠ¥ -->
<style>
  @media (min-width: 768px) {
    #biz-info > div[style*="display: grid"] {
      grid-template-columns: 1fr 1fr;
    }
  }
</style>



</div>

  <div id="container"></div>  <!-- âœ… ì—¬ê¸°ì— ì¶œë ¥ -->
<!-- EmailJS SDK ì¶”ê°€ -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script type="module" src="/app.js?v=20250929-03"></script>

<script>
  const buttons = document.querySelectorAll("#sajuSubmit, #sinsalBtn");

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      // ëª¨ë“  ë²„íŠ¼ì—ì„œ active ì œê±°
      buttons.forEach(b => b.classList.remove("active"));
      // í´ë¦­ëœ ë²„íŠ¼ì— active ì¶”ê°€
      btn.classList.add("active");
    });
  });
</script>


<script>
function gradeToLabel(grade) {
  const g = (grade || 'basic').toLowerCase();
  let roleLabel;
  switch (g) {
    case "admin":   roleLabel = "[ê´€ë¦¬ì] ";   break;
      case "premium3": roleLabel = "[ì •ê¸°íšŒì›3] "; break;
         case "premium6": roleLabel = "[ì •ê¸°íšŒì›6] "; break;
            case "premium": roleLabel = "[ì •ê¸°íšŒì›] "; break;
               case "premium_plus": roleLabel = "[ì •ê¸°íšŒì›+] "; break;
      case "special": roleLabel = "[íŠ¹ë³„íšŒì›] "; break;
      default:        roleLabel = "[ì¼ë°˜íšŒì›] "; break;
  }
  return roleLabel;
}


async function renderProfileHeader(){
  const sb = window.supabaseClient;
  if (!sb) return;

  const sec   = document.getElementById('profile-section');
  const badge = document.getElementById('user-badge');     // â† span ìˆì–´ì•¼ í•´ìš”
  const nick  = document.getElementById('user-nickname');

  const { data: { user } } = await sb.auth.getUser();
  if (!user) { if (sec) sec.style.display='none'; return; }

  const { data: prof, error } = await sb
    .from('profiles')
    .select('grade, nickname')
    .eq('user_id', user.id)
    .single();
  if (error) return;

  if (badge) badge.textContent = gradeToLabel(prof?.grade);
  if (nick)  nick.textContent  = prof?.nickname || (user.email || '');
  if (sec && sec.style.display==='none') sec.style.display='block';
}


// (ì„ íƒ) ì‹¤ì‹œê°„ ê°±ì‹ : profiles.grade ë°”ë€Œë©´ ì¦‰ì‹œ ë°˜ì˜
async function watchProfileGradeRealtime(){
  const sb = window.supabaseClient;
  const { data:{ user } } = await sb.auth.getUser();
  if(!user) return;
  if(window.__profileCh) sb.removeChannel(window.__profileCh);
  window.__profileCh = sb
    .channel(`profile-${user.id}`)
    .on('postgres_changes',{
      event:'UPDATE', schema:'public', table:'profiles', filter:`user_id=eq.${user.id}`
    }, () => { renderProfileHeader(); })
    .subscribe();
}
</script>


<!-- ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ -->

<script>
  const supabase = window.supabaseClient;

  // í† í°/ë¡¤ í—¬í¼
  const getToken = () =>
    localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
  const getRole = () =>
    (localStorage.getItem('userRole') || 'normal').toLowerCase();

  // ê³µì§€ ëª©ë¡ ë Œë” (ìµœì‹  1ê°œë§Œ)
  async function renderNotices() {
    const res = await fetch('/api/notice');
    const data = await res.json();

    const list = document.getElementById('notice-list');
    const addBtn = document.getElementById('add-btn');
    const role = getRole();

    // ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
    if (addBtn) addBtn.style.display = role === 'admin' ? 'inline' : 'none';

    list.innerHTML = '';

    // ìµœì‹  1ê°œë§Œ
    const n = Array.isArray(data) && data.length ? data[0] : null;
    if (!n) {
      const li = document.createElement('li');
      li.textContent = 'ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.';
      list.appendChild(li);
      return;
    }

    const li = document.createElement('li');
    li.innerHTML = `<a href="javascript:void(0)" onclick="openNotice(${n.id})">${n.title}</a>`;

    if (role === 'admin') {
      li.innerHTML += `
        <button onclick="editNotice(${n.id})">ìˆ˜ì •</button>
        <button onclick="deleteNotice(${n.id})">ì‚­ì œ</button>
      `;
    }

    list.appendChild(li);
  }

  // íŒì—…ìœ¼ë¡œ ê³µì§€ ìƒì„¸ ì—´ê¸°
function openNotice(id) {
  // ëª¨ë“  í•­ëª©ì˜ active ì œê±°
  document.querySelectorAll('#notice-list li a').forEach(a => a.classList.remove('active'));

  // í´ë¦­ëœ í•­ëª©ì— active ì¶”ê°€
  const clicked = document.querySelector(`#notice-list li a[onclick="openNotice(${id})"]`);
  if (clicked) {
    clicked.classList.add('active');
    // ğŸ’¡ DOMì´ ì‹¤ì œë¡œ ê·¸ë ¤ì§ˆ ì‹œê°„ì„ í™•ë³´ (íŒì—…ì„ ë°”ë¡œ ì—´ë©´ ë¸Œë¼ìš°ì €ê°€ ë Œë” ìƒëµí•¨)
    requestAnimationFrame(() => {
      window.open(
        `/notice.html?id=${id}`,
        'noticePopup',
        'width=800,height=500,resizable=yes,scrollbars=yes'
      );
    });
  } else {
    window.open(
      `/notice.html?id=${id}`,
      'noticePopup',
      'width=800,height=500,resizable=yes,scrollbars=yes'
    );
  }
}


  // ê³µì§€ ì¶”ê°€ (ì œëª©+ë‚´ìš©)
  document.getElementById('add-btn')?.addEventListener('click', async () => {
    const title = prompt('ìƒˆ ê³µì§€ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:');
    if (title === null) return;
    const content = prompt('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:\n(ì¤„ë°”ê¿ˆ ê°€ëŠ¥)');
    if (content === null) return;

    const newTitle = title.trim();
    const newContent = (content ?? '').trim();
    if (!newTitle || !newContent) {
      alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    const token = getToken();
    const resp = await fetch('/api/notice', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        ...(token ? { Authorization: `Bearer ${token}` } : {})
      },
      body: JSON.stringify({ title: newTitle, content: newContent })
    });

    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      alert(err.error || 'ê³µì§€ ì¶”ê°€ ì‹¤íŒ¨(ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)');
      return;
    }

    renderNotices();
  });

  // ê³µì§€ ìˆ˜ì •: ì œëª©+ë‚´ìš© ëª¨ë‘ ë³€ê²½
  async function editNotice(id) {
    // í˜„ì¬ ë°ì´í„° ì¡°íšŒ
    const cur = await fetch(`/api/notice/${id}`).then(r => r.json());
    if (!cur || !cur.id) {
      alert('ê³µì§€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
      return;
    }

    const title = prompt('ìƒˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:', cur.title || '');
    if (title === null) return;

    const content = prompt('ìƒˆ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:\n(ì¤„ë°”ê¿ˆ ê°€ëŠ¥)', cur.content || '');
    if (content === null) return;

    const newTitle = title.trim();
    const newContent = (content ?? '').trim();
    if (!newTitle || !newContent) {
      alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    const token = getToken();
    const resp = await fetch(`/api/notice/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        ...(token ? { Authorization: `Bearer ${token}` } : {})
      },
      body: JSON.stringify({ title: newTitle, content: newContent })
    });

    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      alert(err.error || 'ê³µì§€ ìˆ˜ì • ì‹¤íŒ¨(ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)');
      return;
    }

    renderNotices();
  }

  // ê³µì§€ ì‚­ì œ
  async function deleteNotice(id) {
    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    const token = getToken();
    const resp = await fetch(`/api/notice/${id}`, {
      method: 'DELETE',
      headers: {
        ...(token ? { Authorization: `Bearer ${token}` } : {})
      }
    });

    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      alert(err.error || 'ê³µì§€ ì‚­ì œ ì‹¤íŒ¨(ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)');
      return;
    }

    renderNotices();
  }




  // ë¡œê·¸ì¸ UI ì—…ë°ì´íŠ¸ (role ì €ì¥/ì‚­ì œ ë° ë²„íŠ¼ ìƒíƒœ ë°˜ì˜)
  async function updateAuthUI(session) {
    const authSection =
      document.getElementById('auth-section') ||
      document.getElementById('login-form') ||
      document.querySelector('.login-form');
    const profileSection = document.getElementById('profile-section');
    const nicknameEl = document.getElementById('user-nickname');
    const historySection = document.getElementById('saju-history-section');

    if (session && session.user) {
      const token = session.access_token;
      const isMobile = /android|iphone|ipad|ipod/i.test(
        navigator.userAgent || ''
      );

      if (isMobile) localStorage.setItem('authToken', token);
      else sessionStorage.setItem('authToken', token);

      if (authSection) authSection.style.display = 'none';
      if (profileSection) profileSection.style.display = 'block';

      const user = session.user;

      // í”„ë¡œí•„ ë¶ˆëŸ¬ì™€ role ì €ì¥
      const { data: profile } = await supabase
        .from('profiles')
        .select('role, created_at, daily_limit')
        .eq('user_id', user.id)
        .single();

      const role = (profile?.role || 'normal').toLowerCase();
      localStorage.setItem('userRole', role); // ë¡œê·¸ì¸ ì‹œ ê°±ì‹ 
    } else {
      // ë¡œê·¸ì•„ì›ƒ ì‹œ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
      localStorage.removeItem('authToken');
      sessionStorage.removeItem('authToken');
      localStorage.removeItem('userRole');

      if (authSection) authSection.style.display = 'block';
      if (profileSection) profileSection.style.display = 'none';
      if (nicknameEl) nicknameEl.textContent = '';
      if (historySection) historySection.style.display = 'none';
    }

    // add-btn ì¦‰ì‹œ ë°˜ì˜
    const addBtn = document.getElementById('add-btn');
    if (addBtn) {
      addBtn.style.display = getRole() === 'admin' ? 'inline' : 'none';
    }
  }

  // ì´ˆê¸°/ë³€ê²½ ë™ì¼ íë¦„ìœ¼ë¡œ ê°±ì‹ 
  (async function init() {
    const sb = window.supabaseClient;

    // ì´ˆê¸°ì—” ë²„íŠ¼ ìˆ¨ê¹€(ê¹œë¹¡ì„ ë°©ì§€)
    const addBtn = document.getElementById('add-btn');
    if (addBtn) addBtn.style.display = 'none';

    // ì„¸ì…˜ ì½ê³  UI ë°˜ì˜
    const { data: { session } } = await sb.auth.getSession();
    await updateAuthUI(session);         // role ì €ì¥/ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 
    await renderProfileHeader();         // âœ… grade ë¼ë²¨ ê·¸ë¦¬ê¸°
    watchProfileGradeRealtime();         // âœ… (ì„ íƒ) ì‹¤ì‹œê°„ ë°˜ì˜

    await renderNotices();               // role ë°˜ì˜ í›„ ê³µì§€ ë Œë”

    // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ/ì„¸ì…˜ë³€ê²½ ì‹œ
    sb.auth.onAuthStateChange(async (_event, newSession) => {
      await updateAuthUI(newSession);
      await renderProfileHeader();       // âœ… ë¼ë²¨ ì¬ê·¸ë¦¬ê¸°
      watchProfileGradeRealtime();       // âœ… êµ¬ë… ë‹¤ì‹œ ê±¸ê¸°
      await renderNotices();
    });
  })();
</script>



<!-- ê´€ë¦¬ì ë©”ë‰´ê´€ë¦¬ -->
<script>
  // roleì— ë”°ë¼ ìš”ì†Œ í‘œì‹œ/ìˆ¨ê¹€
  function showIfAdmin(selector) {
    const el = document.querySelector(selector);
    if (!el) return;
    const role = (localStorage.getItem('userRole') || 'normal').toLowerCase();
    el.style.display = role === 'admin' ? 'inline' : 'none';
  }
</script>





<!-- ë¦¬ì…‹ë²„íŠ¼ì‘ë™ -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const resetBtn = document.getElementById("reset-btn");
  if (resetBtn) {
    resetBtn.addEventListener("click", () => {
      console.log("âœ… ë¦¬ì…‹ ë²„íŠ¼ ëˆŒë¦¼");

      // âœ… ì‚¬ì£¼ ì…ë ¥ í¼ ì „ì²´ ì´ˆê¸°í™”
      const form = document.getElementById("saju-form");
      if (form) form.reset();

      // âœ… ì¶œë ¥ ì „ì²´ ìˆ¨ê¸°ê¸° ë° ë‚´ìš© ì§€ìš°ê¸°
      const resultContainer = document.getElementById("result");
      if (resultContainer) {
        resultContainer.style.display = "none";

        // ë‚´ë¶€ ë‚´ìš©ë„ ì‹¹ ì§€ì›€
        const birthInfo = document.getElementById("birth-info");
        if (birthInfo) birthInfo.innerHTML = "";

        const ganjiTable = document.getElementById("ganji-table");
        if (ganjiTable) ganjiTable.innerHTML = "";

        const todaySaju = document.getElementById("today-saju-container");
        if (todaySaju) todaySaju.innerHTML = "";

        const dangryeong = document.getElementById("dangryeong-table");
        if (dangryeong) dangryeong.innerHTML = "";

        const basicDaeyun = document.getElementById("basic-daeyun-table");
        if (basicDaeyun) basicDaeyun.innerHTML = "";

        const sinsalDaeyun = document.getElementById("sinsal-daeyun-table");
        if (sinsalDaeyun) sinsalDaeyun.innerHTML = "";

        const sinsalBox = document.getElementById("sinsal-box");
        if (sinsalBox) sinsalBox.innerHTML = "";

        const etcSinsalBox = document.getElementById("etc-sinsal-box");
        if (etcSinsalBox) etcSinsalBox.innerHTML = "";
      }

      // âœ… íˆìŠ¤í† ë¦¬ ìˆ¨ê¸°ê¸°
      const historySection = document.getElementById("saju-history-section");
      if (historySection) historySection.style.display = "none";

      // âœ… ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  } else {
    console.log("âŒ reset-btn ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");
  }
});
</script>


<!-- ê³µì§€ê²Œì‹œíŒëª©ë¡ ìƒˆì°½ ë„ìš°ê¸° -->
<script>
  // ê³µì§€ê²Œì‹œíŒ ë©”ë‰´ë¥¼ ì‘ì€ íŒì—… ì°½ìœ¼ë¡œ ì—´ê¸°
  document.querySelector('.top-menu a[href="/index.html"]')?.addEventListener('click', (e) => {
    e.preventDefault();
    window.open(
      '/notice-list.html',
      'noticeWin',
      'width=900,height=650,menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes'
    );
  });
</script>

<script>
// ì „í™”ë²ˆí˜¸ í¬ë§·(ìˆìœ¼ë©´ ì‚¬ìš©)
function normPhone(v){
  const raw=(v||'').trim();
  if(!raw) return null;
  try{return typeof normalizePhoneKR==='function'?normalizePhoneKR(raw,"intl"):raw;}catch{return raw;}
}

// íŒ¨ë„ í† ê¸€
function toggleProfilePanel(forceOpen) {
  const panel = document.getElementById('profile-edit-panel');
  if (!panel) { console.warn('[profile] panel not found'); return; }

  // ì—´ê¸°/ë‹«ê¸° ê²°ì •
  const wantOpen = (forceOpen === undefined)
    ? !panel.classList.contains('open')
    : !!forceOpen;

  // í´ë˜ìŠ¤ + display í•¨ê»˜ ì²˜ë¦¬
  panel.classList.toggle('open', wantOpen);
  panel.setAttribute('aria-hidden', wantOpen ? 'false' : 'true');
  panel.style.display = wantOpen ? 'block' : 'none';

  console.log('[profile] togglePanel ->', wantOpen);
}


// ì…ë ¥ì¹¸ ì±„ìš°ê¸°
async function fillMyProfileForm() {
  const { data: { user } } = await window.supabaseClient.auth.getUser();
  if (!user) return;

  // í”„ë¡œí•„ì—ì„œ ê¸°ë³¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const { data: profile, error } = await window.supabaseClient
    .from("profiles")
    .select("nickname, phone, grade, daily_limit, daily_usage_count")
    .eq("user_id", user.id)
    .maybeSingle();
  if (error) console.warn('[profile] load error', error);

  // ì´ë©”ì¼ì€ auth.userì—ì„œ
  const email = user.email || "";

  // ê°’ ë°˜ì˜
  const nickEl   = document.getElementById("my-nickname");
  const emailEl  = document.getElementById("my-email");
  const phoneEl  = document.getElementById("my-phone");
  const gradeEl  = document.getElementById("my-grade");
  const countEl  = document.getElementById("my-daily-count");

  if (nickEl) {
    const nickVal = profile?.nickname ?? "";
    nickEl.value = nickVal;
    // ë‹‰ë„¤ì„ì´ ì—†ì„ ë•Œë§Œ ì•ˆë‚´ ë©˜íŠ¸ë¥¼ placeholderë¡œ
    nickEl.placeholder = nickVal.trim()
      ? "ë‹‰ë„¤ì„ì€ í•œ ë²ˆ ë” ë“±ë¡í•´ì£¼ì„¸ìš”"
      : "ë‹‰ë„¤ì„ì€ í•œ ë²ˆ ë” ë“±ë¡í•´ì£¼ì„¸ìš”";
  }

  if (emailEl) {
    emailEl.value = email;
    emailEl.readOnly = true; // ì´ë©”ì¼ ìˆ˜ì • ë¶ˆê°€
  }

  if (phoneEl) phoneEl.value = profile?.phone ?? "";

  const used  = profile?.daily_usage_count ?? 0;
  const limit = profile?.daily_limit ?? 0;
  if (gradeEl) gradeEl.textContent = profile?.grade ?? "-";
  if (countEl) countEl.textContent = limit ? `${used}/${limit}` : `${used}/-`;

  // â€» í”Œëœ B: ì¼ì¼ ì¹´ìš´íŠ¸/ë¦¬ë°‹ì´ saju_countsì— ìˆì„ ê²½ìš° ë³´ì •
  if (!limit) {
    const { data: sc } = await window.supabaseClient
      .from("saju_counts")
      .select("used_today, daily_limit")
      .eq("user_id", user.id)
      .maybeSingle();
    const used2 = sc?.used_today ?? used;
    const lim2  = sc?.daily_limit ?? limit;
    if (countEl) countEl.textContent = lim2 ? `${used2}/${lim2}` : `${used2}/-`;
  }
}


// ì €ì¥
async function saveMyProfile() {
  const { data: { user } } = await window.supabaseClient.auth.getUser();
  if (!user) { alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."); return; }

  // ì…ë ¥ê°’
  const nickname = document.getElementById("my-nickname")?.value?.trim() || null;
  const newEmail = document.getElementById("my-email")?.value?.trim() || null;
  const phone    = (function normPhone(v) {
    const raw = (v || '').trim();
    if (!raw) return null;
    try { return typeof normalizePhoneKR === 'function' ? normalizePhoneKR(raw, "intl") : raw; }
    catch { return raw; }
  })(document.getElementById("my-phone")?.value || "");

  // 1) í”„ë¡œí•„ ì—…ë°ì´íŠ¸ (ë‹‰ë„¤ì„/ì „í™”ë²ˆí˜¸)
  const { error: pErr } = await window.supabaseClient
    .from("profiles")
    .update({ nickname, phone })
    .eq("user_id", user.id);
  if (pErr) {
    alert("í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨: " + (pErr.message || "ì˜¤ë¥˜"));
    return;
  }

  // 2) ì´ë©”ì¼ ë³€ê²½ì´ ìˆìœ¼ë©´ auth ê³„ì • ì´ë©”ì¼ ì—…ë°ì´íŠ¸
  //    (ì£¼ì˜: êµ¬ê¸€/ì¹´ì¹´ì˜¤ ë“± ì†Œì…œ ë¡œê·¸ì¸ ê³„ì •ì€ ì´ë©”ì¼ ë³€ê²½ì´ ì œí•œë  ìˆ˜ ìˆìŒ)
  if (newEmail && newEmail !== (user.email || "")) {
    const { data, error: eErr } = await window.supabaseClient.auth.updateUser({ email: newEmail });
    if (eErr) {
      alert("ì´ë©”ì¼ ë³€ê²½ ì‹¤íŒ¨: " + (eErr.message || "ì˜¤ë¥˜"));
      // ì´ë©”ì¼ë§Œ ì‹¤íŒ¨í–ˆì–´ë„ ë‹‰ë„¤ì„/ì „í™”ë²ˆí˜¸ëŠ” ì´ë¯¸ ì €ì¥ë¨
    } else {
      // ì´ë©”ì¼ ë³€ê²½ì€ í™•ì¸ ë©”ì¼ì´ ê°ˆ ìˆ˜ ìˆìŒ (Supabase í”„ë¡œì íŠ¸ ì„¤ì •ì— ë”°ë¦„)
      console.log('[profile] email update result:', data);
    }
  }

  alert("ì €ì¥ ì™„ë£Œ");

  // ìƒë‹¨ ë‹‰ë„¤ì„/ë²„íŠ¼ ë“± ê°±ì‹ 
  const { data: sess } = await window.supabaseClient.auth.getSession();
  if (sess?.session) { updateAuthUI(sess.session); }

  toggleProfilePanel(false);
}

// ì´ë²¤íŠ¸ ë°”ì¸ë”©(ì¤‘ë³µ ë°©ì§€)
function wireProfileEditEvents() {
  const editBtn   = document.getElementById("editProfileBtn");
  const saveBtn   = document.getElementById("my-profile-save");
  const cancelBtn = document.getElementById("my-profile-cancel");

  if (editBtn && !editBtn.dataset.bound) {
    editBtn.addEventListener("click", async () => {
      console.log('[profile] edit clicked'); // â† í´ë¦­ í™•ì¸
      const { data: { user } } = await window.supabaseClient.auth.getUser();
      if (!user) { alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."); return; }
      await fillMyProfileForm();   // í¼ ì±„ìš°ê¸°
      toggleProfilePanel(true);    // ì—´ê¸°
    });
    editBtn.dataset.bound = "1";
  }

  if (saveBtn && !saveBtn.dataset.bound) {
    saveBtn.addEventListener("click", saveMyProfile);
    saveBtn.dataset.bound = "1";
  }

  if (cancelBtn && !cancelBtn.dataset.bound) {
    cancelBtn.addEventListener("click", () => {
      console.log('[profile] cancel clicked');
      toggleProfilePanel(false);
    });
    cancelBtn.dataset.bound = "1";
  }
}


// ì´ˆê¸°í™” ì‹œ í•œ ë²ˆ í˜¸ì¶œ
document.addEventListener("DOMContentLoaded", ()=>{ wireProfileEditEvents(); });

// ë¡œê·¸ì¸ ì„±ê³µ í›„ UI ê°±ì‹  ì‹œì—ë„ ë‹¤ì‹œ ë³´ê°• í˜¸ì¶œ
// updateAuthUI(session) ë‚´ë¶€ì˜ ë¡œê·¸ì¸ ë¶„ê¸° ëë¶€ë¶„ì— ì•„ë˜ í•œ ì¤„ì„ ì¶”ê°€í•´ ë‘ì„¸ìš”:
//   wireProfileEditEvents();
</script>

<script>
  (function setupSajuHistoryOutsideClose() {
    const modal = document.getElementById("saju-history-panel");
    if (!modal) return;

    // íŒ¨ë„ ì—´ë¦¼ ì—¬ë¶€ íŒë‹¨(í‘œí˜„ ë°©ì‹ì— ë§ê²Œ ë³´ì™„ ê°€ëŠ¥)
    const isOpen = () => modal.style.display !== "none";

    // íŒ¨ë„ ë‚´ë¶€ í´ë¦­ì€ ë²„ë¸”ë§ ë§‰ê¸°
    modal.addEventListener("mousedown", (e) => {
      e.stopPropagation();
    });

    // ë¬¸ì„œ ì–´ë””ë“  í´ë¦­í–ˆì„ ë•Œ, íŒ¨ë„ ë°”ê¹¥ì´ë©´ ë‹«ê¸°
    document.addEventListener("mousedown", (e) => {
      if (!isOpen()) return;
      // modal ì˜ì—­ ë°–ì„ í´ë¦­í–ˆëŠ”ì§€?
      if (!modal.contains(e.target)) {
        modal.style.display = "none";
      }
    });

    // Esc í‚¤ë¡œ ë‹«ê¸°
    document.addEventListener("keydown", (e) => {
      if (!isOpen()) return;
      if (e.key === "Escape") {
        modal.style.display = "none";
      }
    });
  })();
</script>


</body>
</html>




